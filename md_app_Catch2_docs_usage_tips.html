<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Software Ontwikkeling: usage-tips</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="placeholder.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Software Ontwikkeling
   &#160;<span id="projectnumber">0</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">usage-tips </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="top"></a> </p>
<h1><a class="anchor" id="autotoc_md616"></a>
Best practices and other tips on using Catch2</h1>
<h2><a class="anchor" id="autotoc_md617"></a>
Running tests</h2>
<p>Your tests should be run in a manner roughly equivalent with:</p>
<div class="fragment"><div class="line">./tests --order rand --warn NoAssertions</div>
</div><!-- fragment --><p>Notice that all the tests are run in a large batch, their relative order is randomized, and that you ask Catch2 to fail test whose leaf-path does not contain an assertion.</p>
<p>The reason I recommend running all your tests in the same process is that this exposes your tests to interference from their runs. This can be both positive interference, where the changes in global state from previous test allow later tests to pass, but also negative interference, where changes in global state from previous test causes later tests to fail.</p>
<p>In my experience, interference, especially destructive interference, usually comes from errors in the code under test, rather than the tests themselves. This means that by allowing interference to happen, our tests can find these issues. Obviously, to shake out interference coming from different orderings of tests, the test order also need to be shuffled between runs.</p>
<p>However, running all tests in a single batch eventually becomes impractical as they will take too long to run, and you will want to run your tests in parallel.</p>
<p><a class="anchor" id="parallel-tests"></a> </p>
<h2><a class="anchor" id="autotoc_md618"></a>
Running tests in parallel</h2>
<p>There are multiple ways of running tests in parallel, with various level of structure. If you are using CMake and CTest, then we provide a helper function <a href="cmake-integration.md#automatic-test-registration"><code>catch_discover_tests</code></a> that registers each Catch2 <code>TEST_CASE</code> as a single CTest test, which is then run in a separate process. This is an easy way to set up parallel tests if you are already using CMake &amp; CTest to run your tests, but you will lose the advantage of running tests in batches.</p>
<p>Catch2 also supports <a href="command-line.md#test-sharding">splitting tests in a binary into multiple shards</a>. This can be used by any test runner to run batches of tests in parallel. Do note that when selecting on the number of shards, you should have more shards than there are cores, to avoid issues with long-running tests getting accidentally grouped in the same shard, and causing long-tailed execution time.</p>
<p><b>Note that naively composing sharding and random ordering of tests will break.</b></p>
<p>Invoking Catch2 test executable like this</p>
<div class="fragment"><div class="line">./tests --order rand --shard-index 0 --shard-count 3</div>
<div class="line">./tests --order rand --shard-index 1 --shard-count 3</div>
<div class="line">./tests --order rand --shard-index 2 --shard-count 3</div>
</div><!-- fragment --><p>does not guarantee covering all tests inside the executable, because each invocation will have its own random seed, thus it will have its own random order of tests and thus the partitioning of tests into shards will be different as well.</p>
<p>To do this properly, you need the individual shards to share the random seed, e.g. </p><div class="fragment"><div class="line">./tests --order rand --shard-index 0 --shard-count 3 --rng-seed 0xBEEF</div>
<div class="line">./tests --order rand --shard-index 1 --shard-count 3 --rng-seed 0xBEEF</div>
<div class="line">./tests --order rand --shard-index 2 --shard-count 3 --rng-seed 0xBEEF</div>
</div><!-- fragment --><p>Catch2 actually provides a helper to automatically register multiple shards as CTest tests, with shared random seed that changes each CTest invocation. For details look at the documentation of <a href="cmake-integration.md#catchshardtestscmake"><code>CatchShardTests.cmake</code> CMake script</a>.</p>
<h2><a class="anchor" id="autotoc_md619"></a>
Organizing tests into binaries</h2>
<p>Both overly large and overly small test binaries can cause issues. Overly large test binaries have to be recompiled and relinked often, and the link times are usually also long. Overly small test binaries in turn pay significant overhead from linking against Catch2 more often per compiled test case, and also make it hard/impossible to run tests in batches.</p>
<p>Because there is no hard and fast rule for the right size of a test binary, I recommend having 1:1 correspondence between libraries in project and test binaries. (At least if it is possible, in some cases it is not.) Having a test binary for each library in project keeps related tests together, and makes tests easy to navigate by reflecting the project's organizational structure.</p>
<hr  />
<p><a href="Readme.md#top">Home</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
