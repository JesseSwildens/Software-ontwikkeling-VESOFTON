<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Software Ontwikkeling: comparing-floating-point-numbers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="placeholder.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Software Ontwikkeling
   &#160;<span id="projectnumber">0</span>
   </div>
   <div id="projectbrief">placeholder</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">comparing-floating-point-numbers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="top"></a> </p>
<h1><a class="anchor" id="autotoc_md111"></a>
Comparing floating point numbers with Catch2</h1>
<p>If you are not deeply familiar with them, floating point numbers can be unintuitive. This also applies to comparing floating point numbers for (in)equality.</p>
<p>This page assumes that you have some understanding of both FP, and the meaning of different kinds of comparisons, and only goes over what functionality Catch2 provides to help you with comparing floating point numbers. If you do not have this understanding, we recommend that you first study up on floating point numbers and their comparisons, e.g. by <a href="https://codingnest.com/the-little-things-comparing-floating-point-numbers/">reading this blog post</a>.</p>
<h2><a class="anchor" id="autotoc_md112"></a>
Floating point matchers</h2>
<div class="fragment"><div class="line">#include &lt;catch2/matchers/catch_matchers_floating_point.hpp&gt;</div>
</div><!-- fragment --><p><a href="matchers.md#top">Matchers</a> are the preferred way of comparing floating point numbers in Catch2. We provide 3 of them:</p>
<ul>
<li><code>WithinAbs(double target, double margin)</code>,</li>
<li><code>WithinRel(FloatingPoint target, FloatingPoint eps)</code>, and</li>
<li><code>WithinULP(FloatingPoint target, uint64_t maxUlpDiff)</code>.</li>
</ul>
<blockquote class="doxtable">
<p><code>WithinRel</code> matcher was introduced in Catch2 2.10.0 </p>
</blockquote>
<p>As with all matchers, you can combine multiple floating point matchers in a single assertion. For example, to check that some computation matches a known good value within 0.1% or is close enough (no different to 5 decimal places) to zero, we would write this assertion:</p>
<div class="fragment"><div class="line"><a class="code" href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a>( computation(input),</div>
<div class="line">    <a class="code" href="namespaceCatch_1_1Matchers.html#a78dba3ba1112c48a6376a38b48ea70e2">Catch::Matchers::WithinRel</a>(expected, 0.001)</div>
<div class="line"> || <a class="code" href="namespaceCatch_1_1Matchers.html#a13a915665906ab3efb39e118c649285f">Catch::Matchers::WithinAbs</a>(0, 0.000001) );</div>
<div class="ttc" id="acatch__matchers_8hpp_html_ac1354db6f3e9c1e0a8eda0eea7ff1f0a"><div class="ttname"><a href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a></div><div class="ttdeci">#define REQUIRE_THAT(arg, matcher)</div><div class="ttdef"><b>Definition:</b> catch_matchers.hpp:222</div></div>
<div class="ttc" id="anamespaceCatch_1_1Matchers_html_a13a915665906ab3efb39e118c649285f"><div class="ttname"><a href="namespaceCatch_1_1Matchers.html#a13a915665906ab3efb39e118c649285f">Catch::Matchers::WithinAbs</a></div><div class="ttdeci">WithinAbsMatcher WithinAbs(double target, double margin)</div><div class="ttdoc">Creates a matcher that accepts numbers within certain range of target.</div><div class="ttdef"><b>Definition:</b> catch_amalgamated.cpp:8211</div></div>
<div class="ttc" id="anamespaceCatch_1_1Matchers_html_a78dba3ba1112c48a6376a38b48ea70e2"><div class="ttname"><a href="namespaceCatch_1_1Matchers.html#a78dba3ba1112c48a6376a38b48ea70e2">Catch::Matchers::WithinRel</a></div><div class="ttdeci">WithinRelMatcher WithinRel(double target, double eps)</div><div class="ttdoc">Creates a matcher that accepts doubles within certain relative range of target.</div><div class="ttdef"><b>Definition:</b> catch_amalgamated.cpp:8215</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md113"></a>
WithinAbs</h3>
<p><code>WithinAbs</code> creates a matcher that accepts floating point numbers whose difference with <code>target</code> is less-or-equal to the <code>margin</code>. Since <code>float</code> can be converted to <code>double</code> without losing precision, only <code>double</code> overload exists.</p>
<div class="fragment"><div class="line"><a class="code" href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a>(1.0, <a class="code" href="namespaceCatch_1_1Matchers.html#a13a915665906ab3efb39e118c649285f">WithinAbs</a>(1.2, 0.2));</div>
<div class="line"><a class="code" href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a>(0.f, !<a class="code" href="namespaceCatch_1_1Matchers.html#a13a915665906ab3efb39e118c649285f">WithinAbs</a>(1.0, 0.5));</div>
<div class="line"><span class="comment">// Notice that infinity == infinity for WithinAbs</span></div>
<div class="line"><a class="code" href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a>(INFINITY, <a class="code" href="namespaceCatch_1_1Matchers.html#a13a915665906ab3efb39e118c649285f">WithinAbs</a>(INFINITY, 0));</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md114"></a>
WithinRel</h3>
<p><code>WithinRel</code> creates a matcher that accepts floating point numbers that are <em>approximately equal</em> to the <code>target</code> with a tolerance of <code>eps.</code> Specifically, it matches if <code>|arg - target| &lt;= eps * max(|arg|, |target|)</code> holds. If you do not specify <code>eps</code>, <code>std::numeric_limits&lt;FloatingPoint&gt;::epsilon * 100</code> is used as the default.</p>
<div class="fragment"><div class="line"><span class="comment">// Notice that WithinRel comparison is symmetric, unlike Approx&#39;s.</span></div>
<div class="line"><a class="code" href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a>(1.0, <a class="code" href="namespaceCatch_1_1Matchers.html#a78dba3ba1112c48a6376a38b48ea70e2">WithinRel</a>(1.1, 0.1));</div>
<div class="line"><a class="code" href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a>(1.1, <a class="code" href="namespaceCatch_1_1Matchers.html#a78dba3ba1112c48a6376a38b48ea70e2">WithinRel</a>(1.0, 0.1));</div>
<div class="line"><span class="comment">// Notice that inifnity == infinity for WithinRel</span></div>
<div class="line"><a class="code" href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a>(INFINITY, <a class="code" href="namespaceCatch_1_1Matchers.html#a78dba3ba1112c48a6376a38b48ea70e2">WithinRel</a>(INFINITY));</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md115"></a>
WithinULP</h3>
<p><code>WithinULP</code> creates a matcher that accepts floating point numbers that are no more than <code>maxUlpDiff</code> <a href="https://en.wikipedia.org/wiki/Unit_in_the_last_place">ULPs</a> away from the <code>target</code> value. The short version of what this means is that there is no more than <code>maxUlpDiff - 1</code> representable floating point numbers between the argument for matching and the <code>target</code> value.</p>
<p>When using the ULP matcher in Catch2, it is important to keep in mind that Catch2 interprets ULP distance slightly differently than e.g. <code>std::nextafter</code> does.</p>
<p>Catch2's ULP calculation obeys these relations:</p><ul>
<li><code>ulpDistance(-x, x) == 2 * ulpDistance(x, 0)</code></li>
<li><code>ulpDistance(-0, 0) == 0</code> (due to the above)</li>
<li><code>ulpDistance(DBL_MAX, INFINITY) == 1</code></li>
<li><code>ulpDistancE(NaN, x) == infinity</code></li>
</ul>
<p><b>Important</b>: The WithinULP matcher requires the platform to use the <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754</a> representation for floating point numbers.</p>
<div class="fragment"><div class="line"><a class="code" href="catch__matchers_8hpp.html#ac1354db6f3e9c1e0a8eda0eea7ff1f0a">REQUIRE_THAT</a>( -0.f, <a class="code" href="namespaceCatch_1_1Matchers.html#a88361ad809aab09ff75c87bf6cdd7fad">WithinULP</a>( 0.f, 0 ) );</div>
<div class="ttc" id="anamespaceCatch_1_1Matchers_html_a88361ad809aab09ff75c87bf6cdd7fad"><div class="ttname"><a href="namespaceCatch_1_1Matchers.html#a88361ad809aab09ff75c87bf6cdd7fad">Catch::Matchers::WithinULP</a></div><div class="ttdeci">WithinUlpsMatcher WithinULP(double target, uint64_t maxUlpDiff)</div><div class="ttdoc">Creates a matcher that accepts doubles within certain ULP range of target.</div><div class="ttdef"><b>Definition:</b> catch_amalgamated.cpp:8203</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md116"></a>
&lt;tt&gt;Approx&lt;/tt&gt;</h2>
<div class="fragment"><div class="line">#include &lt;catch2/catch_approx.hpp&gt;</div>
</div><!-- fragment --><p><b>We strongly recommend against using <code>Approx</code> when writing new code.</b> You should be using floating point matchers instead.</p>
<p>Catch2 provides one more way to handle floating point comparisons. It is <code>Approx</code>, a special type with overloaded comparison operators, that can be used in standard assertions, e.g.</p>
<div class="fragment"><div class="line"><a class="code" href="catch__amalgamated_8hpp.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>(0.99999 == <a class="code" href="classCatch_1_1Approx.html">Catch::Approx</a>(1));</div>
<div class="ttc" id="acatch__amalgamated_8hpp_html_ad57835ba8f1bb419a865ada6bd011a85"><div class="ttname"><a href="catch__amalgamated_8hpp.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a></div><div class="ttdeci">#define REQUIRE(...)</div><div class="ttdef"><b>Definition:</b> catch_amalgamated.hpp:6240</div></div>
<div class="ttc" id="aclassCatch_1_1Approx_html"><div class="ttname"><a href="classCatch_1_1Approx.html">Catch::Approx</a></div><div class="ttdef"><b>Definition:</b> catch_amalgamated.hpp:3099</div></div>
</div><!-- fragment --><p><code>Approx</code> supports four comparison operators, <code>==</code>, <code>!=</code>, <code>&lt;=</code>, <code>&gt;=</code>, and can also be used with strong typedefs over <code>double</code>s. It can be used for both relative and margin comparisons by using its three customization points. Note that the semantics of this is always that of an <em>or</em>, so if either the relative or absolute margin comparison passes, then the whole comparison passes.</p>
<p>The downside to <code>Approx</code> is that it has a couple of issues that we cannot fix without breaking backwards compatibility. Because Catch2 also provides complete set of matchers that implement different floating point comparison methods, <code>Approx</code> is left as-is, is considered deprecated, and should not be used in new code.</p>
<p>The issues are</p><ul>
<li>All internal computation is done in <code>double</code>s, leading to slightly different results if the inputs were floats.</li>
<li><code>Approx</code>'s relative margin comparison is not symmetric. This means that <code>Approx( 10 ).epsilon(0.1) != 11.1</code> but <code>Approx( 11.1 ).epsilon(0.1) == 10</code>.</li>
<li>By default, <code>Approx</code> only uses relative margin comparison. This means that <code>Approx(0) == X</code> only passes for <code>X == 0</code>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md117"></a>
Approx details</h3>
<p>If you still want/need to know more about <code>Approx</code>, read on.</p>
<p>Catch2 provides a UDL for <code>Approx</code>; <code>_a</code>. It resides in the <code><a class="el" href="namespaceCatch_1_1literals.html">Catch::literals</a></code> namespace, and can be used like this:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceCatch_1_1literals.html">Catch::literals</a>;</div>
<div class="line"><a class="code" href="catch__amalgamated_8hpp.html#ad57835ba8f1bb419a865ada6bd011a85">REQUIRE</a>( performComputation() == 2.1_a );</div>
<div class="ttc" id="anamespaceCatch_1_1literals_html"><div class="ttname"><a href="namespaceCatch_1_1literals.html">Catch::literals</a></div><div class="ttdef"><b>Definition:</b> catch_amalgamated.cpp:605</div></div>
</div><!-- fragment --><p><code>Approx</code> has three customization points for the comparison:</p>
<ul>
<li><b>epsilon</b> - epsilon sets the coefficient by which a result can differ from <code>Approx</code>'s value before it is rejected. <em>Defaults to <code>std::numeric_limits&lt;float&gt;::epsilon()*100</code>.</em></li>
</ul>
<div class="fragment"><div class="line"><a class="code" href="namespaceCatch_1_1Matchers.html#a935746b6148231574ee244d5110fae18">Approx</a> target = <a class="code" href="namespaceCatch_1_1Matchers.html#a935746b6148231574ee244d5110fae18">Approx</a>(100).epsilon(0.01);</div>
<div class="line">100.0 == target; <span class="comment">// Obviously true</span></div>
<div class="line">200.0 == target; <span class="comment">// Obviously still false</span></div>
<div class="line">100.5 == target; <span class="comment">// True, because we set target to allow up to 1% difference</span></div>
<div class="ttc" id="anamespaceCatch_1_1Matchers_html_a935746b6148231574ee244d5110fae18"><div class="ttname"><a href="namespaceCatch_1_1Matchers.html#a935746b6148231574ee244d5110fae18">Catch::Matchers::Approx</a></div><div class="ttdeci">ApproxMatcher&lt; T, AllocComp, AllocMatch &gt; Approx(std::vector&lt; T, AllocComp &gt; const &amp;comparator)</div><div class="ttdoc">Creates a matcher that matches vectors that comparator as an element.</div><div class="ttdef"><b>Definition:</b> catch_matchers_vector.hpp:181</div></div>
</div><!-- fragment --><ul>
<li><b>margin</b> - margin sets the absolute value by which a result can differ from <code>Approx</code>'s value before it is rejected. <em>Defaults to <code>0.0</code>.</em></li>
</ul>
<div class="fragment"><div class="line"><a class="code" href="namespaceCatch_1_1Matchers.html#a935746b6148231574ee244d5110fae18">Approx</a> target = <a class="code" href="namespaceCatch_1_1Matchers.html#a935746b6148231574ee244d5110fae18">Approx</a>(100).margin(5);</div>
<div class="line">100.0 == target; <span class="comment">// Obviously true</span></div>
<div class="line">200.0 == target; <span class="comment">// Obviously still false</span></div>
<div class="line">104.0 == target; <span class="comment">// True, because we set target to allow absolute difference of at most 5</span></div>
</div><!-- fragment --><ul>
<li><b>scale</b> - scale is used to change the magnitude of <code>Approx</code> for the relative check. <em>By default, set to <code>0.0</code>.</em></li>
</ul>
<p>Scale could be useful if the computation leading to the result worked on a different scale than is used by the results. Approx's scale is added to Approx's value when computing the allowed relative margin from the Approx's value.</p>
<hr  />
<p><a href="Readme.md#top">Home</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
